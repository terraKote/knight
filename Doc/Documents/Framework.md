# Knight's frame structure

## Frame structure diagram
![knight's frame structure](/Doc/res/images/knight_framework.png)

## Core Libraries
* The CoreLib layer mainly provides a series of basic libraries that do not depend on the Knight framework.

### Json parsing library (WindJson)
* Support standard Json format analysis
* Conveniently convert between object/jsonstring/jsonnode
* Compatible with repeated commas and semicolons
* Support the recognition of enumerated types and true/false keywords
* Support // /**/ Recognition of comments

### Coroutine Management (Coroutine)
* Coroutine uses unified management, so that the startup of Ctrip no longer depends on MonoBehaviour
* Realize the coroutine object returned with custom parameters such as WWW/AssetBundleRequest to simplify the code structure of the coroutine
* Use Async Await to replace Coroutine, and implement mutual calling and conversion between them

### Serialization (Serializer)
* Analyze classes with serialized attributes, and automatically generate serialized codes for attributes
* Used for serialization of configuration to speed up data loading

### Math Library (Math)
* Provide the implementation of some complex algorithms in the game development process
* AABB area overlap division algorithm
* Path algorithm based on segmented straight line
* Provide basic and public algorithms

### Basic Assisted Development Library (Assist)
* Provide a series of extension methods for basic classes to simplify the code
* Provide a series of basic auxiliary classes (reflection assistance, object pool, encryption and decryption algorithm, lexical analysis, singleton template)
* Provide a Dict, which is a simplified data structure of Dictionary

## Plugins
* ILRuntime: A library written in C# to explain and run C# IL code, used to implement the hot update mechanism, address: https://github.com/Ourpalm/ILRuntime
* EgametangClient: The server in the Egametang open source framework, address: https://github.com/egametang/Egametang The library address of its independent client network module: https://github.com/winddyhe/egametang-network-client
* NaughtyAttributes: A script Inspector UI extension library, Editor extension implemented by Attribute tags. Address: https://github.com/dbrizov/NaughtyAttributes

## Framework layer
* Framework layer mainly includes expansion, Assetbundle resource management module, hot update management module, graphics rendering, input, UGUI extended control group, network connection module.
* This layer depends on CoreLib and Plugins.

### Assetbundle Resource Management Module (Assetbundle Management)
* Integrate the official AssetbundleBrowser resource packaging tool
* Unified resource loading interface, automatically load resources based on dependencies
* Realize the resource package download process
* Realize the unified loading interface of the resource management module Editor Simulate and non-Editor, which can be switched freely according to different resource types

### Hotfix Management module (Hotfix Management)
* Use ILRuntime to achieve full logic hot update of C#
* The hot update DLL is added to the Assetbundle resource package for management
* Provide MonoBehaviour proxy class, use Atrribute to encapsulate the data acquisition interface, so that the hot update terminal can concisely obtain the reference of the object from the Prefab
* Provide global event trigger management, so that the hot update terminal can obtain the messages generated by Unity

### Graphics rendering module (Graphics)
* Provide a series of commonly used functional Shader
* High-efficiency 3D UI, Image and Text, which can automatically merge batches, suitable for blood bars and floating characters

### Input module (Input)
* The function of Simulating Touch on PC
* Encapsulate the input interface of Touch, Mouse, Keyboard

### WindUI
* Provides a UGUI-based atlas management module UIAtlasManager
* Implement a lightweight MVVM UI framework, completely separate data logic and UI display logic, and provide a series of data and event binding scripts.
* Provide UGUI-based commonly used extended control groups
* ImageReplace is used to dynamically replace an image in the code
* EmptGraphics is used to specify whether a blank UI area can accept click events
* Gradient font gradient script
* LoopScrollRect loop list
* TabView Tab cut page component
* TextStyleSelector font style component
* ClickMemu pop-up box control with dynamic width and height position
* Toast is a control used to display prompt information

### Network connection module (Network)
* Provide a TCP network connection module, the whole module is modified on the basis of ET and conforms to Knight's coding rules
* Docking with ET server

## Editor Tools Expanding
### Assetbundle Build Tools
* Integrate the official AssetbundleBrowser resource packaging tool, and replace its packaging interface with Knight's resource type packaging method
* Other tools related to resource preprocessing

### Excel Reader
* Export Excel spreadsheet to Json format

### Scipt Inspectors
* Editor extensions that provide a series of scripts

### Memory Profiler Compare
* PA_ResourceTracker, used for memory resource tracking, address: https://github.com/PerfAssist/PA_ResourceTracker
* Provide a tool to grab the current UnityEngine.Object object in the game (ObjectsSearch)

### Effect Tools
* Provide a tool to copy the current GameObject node with Animation animation data, and the animation data will be copied together.

## Game part (Game)
* The goal of this framework is to write all the logic of the game in the hot update DLL.
* The game is mainly composed of two parts, hot update modules and resources.

### resource
* Original Resources are original resources, these original resources will be packaged into Assetbundle packages for game use.
* Assetbundle Packages are the original resource packages used in the game.

### Game Hot Update Module (HofixModule Game Logic)
* Hotfix Core Lib (Hotfix Core Lib)
* WindUI, the hot update part of the MVVM UI framework, completely separates data logic and display logic. We only need to care about data logic operations and data binding, and the rest of the framework will help us complete.
* GameStage, an asynchronous level loading management module, handles the logic of the level in stages, and supports parallel processing of multiple loading tasks.
* Network, the network connection module of the hot update terminal.

* GUI Logic, the GUI logic part of the game

* Battle Logic, the battle logic part of the game (TODO)